# b3go
## 概念
### NodeStaus
- `SUCCESS` - 节点执行成功
- `FAILURE` - 节点执行失败
- `RUNNING` - 节点运行中，用作持续性动作
- `ERROR` - 报错，一般用作程序异常，不再常规逻辑
### Memory
- 一些节点会有Mem前缀（MemSequence等），用来记录当前运行到哪个`RUNNING`节点。通常子节点都是持续节点。
- 在第一次进入该节点后会记忆这帧执行到底子节点索引index，等下次，如果还是执行到这个Mem节点就跳到上次记忆的子节点index开始执行。
- 如果下一帧没能走到这个Mem节点，就会丢失记忆（重新进入open函数），等到下次再进入Mem节点，还是从第一个节点开始执行
### Persistent
- 瞬时节点：瞬间的动作，比如打印日志，设置变量等，只会返回`SUCCESS`or`FAILURE`
- 持续节点：会持续一段时间的动作，必须wait，行走到某个点，会多返回一个`RUNNING`状态。表示动作还是执行中，下帧还需要继续执行。
## 节点类型
### Composite
用作一个节点分支多个节点，抽象对子节点操作的方式，并交操作和不同返回。
会走记忆逻辑。
- Sequence (顺序节点)
  - 特性：遍历子节点，子节点`SUCCESS`就执行下一个，最后返回`SUCCESS`，否则返回不成功的子节点状态。
  - 类似 and 语义。
  - 主要用作多个条件，后面做多件事，一般子节点是瞬时节点
- Priorty | Selector (选择节点)
  - 特性：遍历子节点，子节点`FAILURE`就执行下一个，最后返回`FAILURE`，否则返回非失败的子节点状态
  - 类似 or 语义，只会选择一个成功节点。
  - 主要用作多个分支选择其一
- MemSequence (记忆顺序节点)
  - 特性：遍历子节点，从记忆点开始执行，子节点`SUCCESS`就执行下一个，最后返回`SUCCESS`，否则返回非成功的子节点状态，如果子节点结果是`RUNNING`状态，记忆当前子节点索引
  - 作用类似Sequence，只是会记忆最后`RUNNING`的子节点索引，后面直接从这个节点开始执行
- MemPriorty | MemSelector (记忆选择节点)
  - 特性：遍历子节点，从记忆点开始执行，子节点`FAILURE`就执行下一个，最后返回`FAILURE`，否则返回非失败的子节点状态，如果子节点结果是`RUNNING`状态，记忆当前子节点索引
  - 作用类似Priorty，只是会记忆最后`RUNNING`的子节点索引，后面直接从这个节点开始执行
- Parallel (并行节点)
  - 作用：会一次遍历完所有子节点，然后根据成功和失败数量比对参数返回成功还是失败。适合一些并行执行互不影响的行为。
- Random (随机节点)
  - 作用：首次进入节点根据权重随机一个子节点执行。持续动作会记忆索引，一直执行到结束。
### Decorator
用作节点的条件修饰，比如取反，限时，限定次数等。
会走记忆逻辑。
- Inverter (取反)
  - 作用：执行节点时候把子节点结果取反,`RUNNING`原样返回。
- Repeater (重复执行)
  - 特性：记忆一个索引值，在次数范围内，执行N次子节点。返回值如果是`RUNNING`就break返回`RUNNING`。`SUCCESS`或者`FAILURE`则次数++，循环执行到N次结束，返回最后一次执行的结果。
  - 作用:
    * 子节点是持续节点：子节点在`RUNNING`状态不计数，直到子节点执行结束才计数+1同时在执行N次，下一帧以新的计数开始。计数结束返回这帧最后一个节点结果
    * 子节点是瞬时节点：子节点结束，计数+1，直到计数结束返回成功-
- RepeatUntilFailure (重复执行直至失败)
  - 特性：类似repeat，区别是子节点`SUCCESS`会导致记忆索引++再次执行子节点直到超出范围，推出循环记录记忆索引，返回这帧最后一个节点结果
  - 作用：用作一直尝试等行为失败，loop用作保护最大次数防止死循环。支持持续节点。
- RepeatUntilSuccess (重复执行直至成功)
  - 特性：类似repeatUntilFailure，记录索引的条件为`FAILURE`
  - 作用：用作一直尝试等行为成功，loop用作保护最大次数防止死循环。支持持续节点。
- MaxTime (执行持续)
  - 特性：记忆第一次打开的时间，每次执行判断时间是否超时，不超时返回节点返回值，否则返回`FAILURE`
  - 作用：持续执行动作多久，并不是阻塞等待，而是一个节点返回`FAILURE`的保护时间，一帧执行一次
- Limiter (执行上限)
  - 特性：次数范围内，每帧执行一次子节点，`SUCCESS`或者`FAILURE`增加计数。超出范围返回Fail
  - 作用：做一些特殊的触发条件，比如HP<10%，发动特殊攻击。不过要小心，脱离战斗以后要重置黑板，不然再也不会触发。
### Condition
只有返回类型，不执行的节点。类似if(cond)里面的cond函数。
一般父节点用Sequence，子节点用多个限制条件，下面跟Action。
### Action
可以返回类型，执行的节点，跟逻辑事件关联。
- Wait (等待)
  * 特性：持续节点，等待一段时间，在固定时间内一直返回`RUNNING`状态
- SubTree (加载子树)
  * 特性：加载一个子树，返回树的执行结果
  * 作用：多个树组合，还可以实现独立的树有独立的记忆链（参考Parallel）。
